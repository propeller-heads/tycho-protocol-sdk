specVersion: v0.1.0
package:
  name: "ethereum_renzo"
  version: v0.1.0

protobuf:
  files:
    - tycho/evm/v1/vm.proto
    - tycho/evm/v1/common.proto
    - tycho/evm/v1/utils.proto
  importPaths:
    - ../../proto
    - ./proto

binaries:
  default:
    type: wasm/rust-v1
    file: ../target/wasm32-unknown-unknown/release/ethereum_sfrax.wasm

modules:
  - name: map_components
    kind: map
    initialBlock: 18722789 #Renzo Restake Manager Contract Creation Tx
    inputs:
      - params: string
      - source: sf.ethereum.type.v2.Block
    output:
      type: proto:tycho.evm.v1.BlockTransactionProtocolComponents
    doc: |
      param is the address without the 0x prefix of the sfrax vault you want to track

  - name: store_components
    kind: store
    initialBlock: 18722789
    updatePolicy: add
    valueType: int64
    inputs:
      - map: map_components

  - name: store_balances
    kind: store
    initialBlock: 18722789
    updatePolicy: add
    valueType: bigint
    inputs:
      - map: map_relative_balances

  - name: map_relative_balances
    kind: map
    initialBlock: 18722789
    inputs:
      - source: sf.ethereum.type.v2.Block
      - store: store_components
    output:
      type: proto:tycho.evm.v1.BlockBalanceDeltas

  - name: map_protocol_changes
    kind: map
    initialBlock: 18722789
    inputs:
      - source: sf.ethereum.type.v2.Block
      - map: map_components
      - map: map_relative_balances
      - store: store_components
      - store: store_balances
        mode: deltas
    output:
      type: proto:tycho.evm.v1.BlockChanges

params:
  # Renzo Restake Manager Contract - Users deposit and withdraw from the protocol
  map_components: "74a09653A083691711cF8215a6ab074BB4e99ef5"






# specVersion: v0.1.0
# package:
#   name: ethereum_renzo
#   version: v0.1.0

# imports:
#     ethcommon: https://spkg.io/streamingfast/ethereum-common-v0.3.0.spkg

# protobuf:
#   files:
#     - contract.proto
#   importPaths:
#     - ./proto
#   excludePaths:
#     - sf/substreams
#     - google

# binaries:
#   default:
#     type: wasm/rust-v1
#     file: ./target/wasm32-unknown-unknown/release/substreams.wasm

# modules:

#   - name: map_events
#     kind: map
#     initialBlock: 18722789
#     blockFilter:
#       module: ethcommon:index_events
#       query:
#         string: evt_addr:0x74a09653a083691711cf8215a6ab074bb4e99ef5 || evt_addr:0x5efc9d10e42fb517456f4ac41eb5e2ebe42c8918
#     inputs:
#       - source: sf.ethereum.type.v2.Block
#     output:
#       type: proto:contract.v1.Events
#   - name: map_calls
#     kind: map
#     initialBlock: 18722789
#     blockFilter:
#       module: ethcommon:index_calls
#       query:
#         string: call_to:0x74a09653a083691711cf8215a6ab074bb4e99ef5 || call_to:0x5efc9d10e42fb517456f4ac41eb5e2ebe42c8918
#     inputs:
#       - source: sf.ethereum.type.v2.Block
#     output:
#       type: proto:contract.v1.Calls
#   - name: map_events_calls
#     kind: map
#     initialBlock: 18722789
#     inputs:
#       - map: map_events
#       - map: map_calls
#     output:
#       type: proto:contract.v1.EventsCalls
# network: mainnet
