specVersion: v0.1.0
package:
  name: "ethereum_rocketpool"
  version: v0.2.0

protobuf:
  files:
    - tycho/evm/v1/common.proto
    - tycho/evm/v1/utils.proto
  importPaths:
    - ../../proto

binaries:
  default:
    type: wasm/rust-v1
    file: ../target/wasm32-unknown-unknown/release/ethereum_rocketpool.wasm


network: mainnet

params:
  map_protocol_components: &starting_block 24479942 # Saturn I activation block (Feb 17, 2026)
  # Rocket Pool state values at the starting block needed as we start indexing at Saturn I activation.
  # To regenerate these values for a different starting block, run:
  #   RPC_URL=<your-archive-rpc> ./scripts/compute_initial_state.sh <block_number>
  #
  # TODO: Regenerate with archive node at exact block 24479942. Current values are from a nearby
  # block and serve as placeholders. The script requires an archive node RPC.
  map_protocol_changes: |
    {
      "deposit_contract_balance": "0x000000000000000000000000000000000000000000000037d06a1e87e21ce473",
      "reth_contract_liquidity": "0x0000000000000000000000000000000000000000000000d6ff40e8ec2ee5f783",
      "deposits_enabled": "0x0000000000000000000000000000000000000000000000000000000000000001",
      "deposit_assigning_enabled": "0x0000000000000000000000000000000000000000000000000000000000000001",
      "deposit_assign_maximum": "0x000000000000000000000000000000000000000000000000000000000000005a",
      "deposit_assign_socialised_maximum": "0x0000000000000000000000000000000000000000000000000000000000000000",
      "min_deposit_amount": "0x000000000000000000000000000000000000000000000000002386f26fc10000",
      "max_deposit_pool_size": "0x00000000000000000000000000000000000000000004f68ca6d8cd91c6000000",
      "deposit_fee": "0x0000000000000000000000000000000000000000000000000001c6bf52634000",
      "megapool_queue_requested_total": "0x0000000000000000000000000000000000000000000008445cd6053712000000",
      "megapool_queue_index": "0x000000000000000000000000000000000000000000000000000000000000043b",
      "express_queue_rate": "0x0000000000000000000000000000000000000000000000000000000000000004",
      "total_eth": "0x0000000000000000000000000000000000000000000054062a09df6ac8fa3f4d",
      "reth_supply": "0x00000000000000000000000000000000000000000000488d299d44607e1ba76e"
    }

modules:
  - name: map_protocol_components
    kind: map
    initialBlock: *starting_block
    inputs:
      - params: string
      - source: sf.ethereum.type.v2.Block
    output:
      type: proto:tycho.evm.v1.BlockTransactionProtocolComponents

  - name: map_protocol_changes
    kind: map
    initialBlock: *starting_block
    inputs:
      - params: string
      - source: sf.ethereum.type.v2.Block
      - map: map_protocol_components
    output:
      type: proto:tycho.evm.v1.BlockChanges
